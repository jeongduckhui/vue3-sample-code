
const ParentScreen = () => {
  const [rowData, setRowData] = useState([]);
  const [traceInfo, setTraceInfo] = useState(null);

  const { markFetchEnd, uiTimeMs } =
    useUiRenderTime([rowData.length]);

  const loadData = async () => {
    const res = await fetchWithUiTrace({
      fetchFn: () => axios.get('/api/data'),
      markFetchEnd,
    });

    setRowData(res.data.rows);

    setTraceInfo(res.traceBase); // uiTimeì€ ì•„ì§ ì—†ìŒ
  };

  // ðŸ”¥ uiTimeì´ ê³„ì‚°ëœ "í›„"ì— í•©ì„±
  useEffect(() => {
    if (!traceInfo || uiTimeMs == null) return;

    setTraceInfo(prev => ({
      ...prev,
      uiTimeMs,
      totalTimeMs:
        prev.networkTimeMs +
        prev.serverTxTimeMs +
        uiTimeMs,
    }));
  }, [uiTimeMs]);

  return <TracePopup traceInfo={traceInfo} />;
};


export async function fetchWithUiTrace({
  fetchFn,
  markFetchEnd,
}) {
  const fetchStart = performance.now();
  const res = await fetchFn();
  const fetchEnd = performance.now();

  markFetchEnd(fetchEnd);

  return {
    ...res,
    traceBase: {
      networkTimeMs: fetchEnd - fetchStart,
      serverTxTimeMs: res.data?.trace?.transactionTimeMs ?? 0,
    },
  };
}


// useUiRenderTime.js
import { useEffect, useRef, useState } from 'react';

export function useUiRenderTime(deps = []) {
  const fetchEndRef = useRef(null);
  const [uiTimeMs, setUiTimeMs] = useState(null);

  const markFetchEnd = time => {
    fetchEndRef.current = time;
    setUiTimeMs(null); // ì´ˆê¸°í™”
  };

  useEffect(() => {
    if (!fetchEndRef.current) return;

    const elapsed = performance.now() - fetchEndRef.current;
    setUiTimeMs(elapsed);
  }, deps);

  return {
    markFetchEnd,
    uiTimeMs,
  };
}
