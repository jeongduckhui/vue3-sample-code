
// TracePopup.jsx
const TracePopup = ({ traceInfo }) => {
  return (
    <div>
      <div>네트워크: {traceInfo.networkTimeMs}</div>
      <div>서버Tx: {traceInfo.serverTxTimeMs}</div>
      <div>UI: {traceInfo.uiTimeMs}</div>
      <div>총소요: {traceInfo.totalTimeMs}</div>
    </div>
  );
};




// src/screens/ParentScreen.jsx
import React, { useState } from 'react';
import axios from 'axios';
import { useTraceQuery } from '../hooks/useTraceQuery';
import TracePopup from '../components/TracePopup';

const ParentScreen = () => {
  const [rowData, setRowData] = useState([]);

  const { data, traceInfo, execute } = useTraceQuery({
    depsForUiRender: [rowData],
  });

  const loadData = async () => {
    const searchParam = {
      customerId: 'C001',
      fromDate: '2026-01-01',
      toDate: '2026-01-31',
    };

    const res = await execute(() =>
      axios.get('/api/data', { params: searchParam })
    );

    setRowData(res.data.rows);
  };

  return (
    <>
      <button onClick={loadData}>조회</button>

      {traceInfo && <TracePopup traceInfo={traceInfo} />}
    </>
  );
};

export default ParentScreen;






// src/hooks/useTraceQuery.js
import { useState } from 'react';
import { useUiRenderTime } from './useUiRenderTime';
import { fetchWithUiTrace } from '../utils/fetchWithUiTrace';

export function useTraceQuery({ depsForUiRender = [] } = {}) {
  const [data, setData] = useState(null);
  const [traceInfo, setTraceInfo] = useState(null);

  const { markFetchEnd, waitForUiRendered } =
    useUiRenderTime(depsForUiRender);

  const execute = async fetchFn => {
    const res = await fetchWithUiTrace({
      fetchFn,
      markFetchEnd,
      waitForUiRendered,
    });

    setData(res.data);
    setTraceInfo(res.trace);

    return res; // 필요하면 호출부에서도 사용 가능
  };

  return {
    data,
    traceInfo,
    execute,
  };
}
